version: "3.9"

services:
  # ========================
  # Base de datos PostgreSQL
  # ========================
  postgres:
    image: postgres:15
    container_name: postgres_curso
    restart: always
    environment:
      POSTGRES_USER: devdb
      POSTGRES_PASSWORD: a1b2c3d4
      POSTGRES_DB: curso_springboot
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - spring-net

  # ========================
  # Eureka Service (opcional)
  # ========================
  eureka-server:
    image: eurekaserver:latest
    container_name: eureka_server
    build:
      context: ./eureka-server
    ports:
      - "8761:8761"
    networks:
      - spring-net

  # ========================
  # Curso Service (Spring Boot)
  # ========================
  curso-service:
    image: curso-service:latest
    container_name: curso_service
    build:
      context: ./curso-service
    restart: always
    depends_on:
      - postgres
      - eureka-server
    environment:
      SPRING_DATASOURCE_URL: jdbc:postgresql://postgres:5432/curso_springboot
      SPRING_DATASOURCE_USERNAME: devdb
      SPRING_DATASOURCE_PASSWORD: a1b2c3d4
      SPRING_JPA_HIBERNATE_DDL_AUTO: create-drop
      SPRING_JPA_SHOW_SQL: "true"
      SERVER_PORT: 8082
      EUREKA_CLIENT_SERVICEURL_DEFAULTZONE: http://eureka-server:8761/eureka/
      MANAGEMENT_SERVER_PORT: 8081
    ports:
      - "8082:8082"
      - "8081:8081"
    networks:
      - spring-net

  # ========================
  # (Opcional) Otros servicios
  # ========================
  usuario-service:
    image: usuario-service:latest
    container_name: usuario_service
    build:
      context: ./usuario-service
    ports:
      - "8080:8080"
    networks:
      - spring-net
    depends_on:
      - eureka-server

  semestre-service:
    image: semestre-service:latest
    container_name: semestre_service
    build:
      context: ./semestre-service
    ports:
      - "8084:8084"
    networks:
      - spring-net
    depends_on:
      - eureka-server

# ========================
# Vol√∫menes y Red
# ========================
volumes:
  postgres_data:

networks:
  spring-net:
    driver: bridge
